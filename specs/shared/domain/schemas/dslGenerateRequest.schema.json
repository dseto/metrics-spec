{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "dslGenerateRequest.schema.json",
  "title": "DslGenerateRequest",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "goalText",
    "sampleInput",
    "dslProfile",
    "constraints"
  ],
  "properties": {
    "goalText": {
      "type": "string",
      "minLength": 10,
      "maxLength": 4000,
      "description": "Natural language description of the desired CSV/output."
    },
    "sampleInput": {
      "type": [
        "object",
        "array"
      ],
      "description": "JSON sample from the source API."
    },
    "dslProfile": {
      "type": "string",
      "enum": [
        "jsonata",
        "jmespath"
      ],
      "default": "jsonata"
    },
    "constraints": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "maxColumns",
        "allowTransforms",
        "forbidNetworkCalls",
        "forbidCodeExecution"
      ],
      "properties": {
        "maxColumns": {
          "type": "integer",
          "minimum": 1,
          "maximum": 200,
          "default": 50
        },
        "allowTransforms": {
          "type": "boolean",
          "default": true
        },
        "forbidNetworkCalls": {
          "type": "boolean",
          "default": true
        },
        "forbidCodeExecution": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "hints": {
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": {
        "type": "string"
      },
      "description": "Optional hints (e.g., desired column names)."
    },
    "existingDsl": {
      "type": [
        "string",
        "null"
      ],
      "maxLength": 20000,
      "description": "Existing DSL text for refinement (optional)."
    },
    "existingOutputSchema": {
      "type": [
        "object",
        "null"
      ],
      "description": "Existing output schema for refinement (optional)."
    }
  },
  "examples": [
    {
      "goalText": "Quero um CSV com timestamp, hostName e cpuUsagePercent (0-100).",
      "sampleInput": {
        "result": [
          {
            "timestamp": "2026-01-01T00:00:00Z",
            "host": "srv01",
            "cpu": 0.73
          }
        ]
      },
      "dslProfile": "jsonata",
      "constraints": {
        "maxColumns": 30,
        "allowTransforms": true,
        "forbidNetworkCalls": true,
        "forbidCodeExecution": true
      },
      "hints": {
        "columns": "timestamp,hostName,cpuUsagePercent"
      }
    }
  ]
}
