{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "dslGenerateRequest.schema.json",
  "title": "DslGenerateRequest",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "goalText",
    "sampleInput",
    "dslProfile",
    "constraints"
  ],
  "properties": {
    "goalText": {
      "type": "string",
      "minLength": 10,
      "maxLength": 4000,
      "description": "Natural language description of the desired CSV/output."
    },
    "sampleInput": {
      "type": [
        "object",
        "array"
      ],
      "description": "JSON sample from the source API."
    },
    "dslProfile": {
      "type": "string",
      "enum": [
        "ir"
      ],
      "default": "ir",
      "description": "Profile de DSL suportado. Atualmente apenas 'ir' (Intermediate Representation / PlanV1) é aceito."
    },
    "constraints": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "maxColumns",
        "allowTransforms",
        "forbidNetworkCalls",
        "forbidCodeExecution"
      ],
      "properties": {
        "maxColumns": {
          "type": "integer",
          "minimum": 1,
          "maximum": 200,
          "default": 50
        },
        "allowTransforms": {
          "type": "boolean",
          "default": true
        },
        "forbidNetworkCalls": {
          "type": "boolean",
          "default": true
        },
        "forbidCodeExecution": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "hints": {
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": {
        "type": "string"
      },
      "description": "Optional hints (e.g., desired column names)."
    },
    "existingDsl": {
      "type": [
        "string",
        "null"
      ],
      "maxLength": 20000,
      "description": "Existing DSL text for refinement (optional)."
    },
    "existingOutputSchema": {
      "type": [
        "object",
        "null"
      ],
      "description": "Existing output schema for refinement (optional)."
    },
    "engine": {
      "description": "(Optional) Overrides server-side AI engine selection. Atualmente apenas 'plan_v1' (PlanV1 IR) é suportado.",
      "type": "string",
      "enum": [
        "plan_v1"
      ],
      "default": "plan_v1"
    }
  },
  "examples": [
    {
      "goalText": "Extrair timestamp e host e cpu em % do primeiro item",
      "sampleInput": {
        "result": [
          {
            "timestamp": "2026-01-01T00:00:00Z",
            "host": "srv01",
            "cpu": 0.73
          }
        ]
      },
      "dslProfile": "ir",
      "constraints": {
        "maxFields": 10
      },
      "engine": "plan_v1"
    }
  ]
}