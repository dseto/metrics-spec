{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "connector.schema.json",
  "title": "Connector",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "id",
    "name",
    "baseUrl",
    "timeoutSeconds"
  ],
  "properties": {
    "id": {
      "$ref": "id.schema.json"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 120
    },
    "baseUrl": {
      "type": "string",
      "minLength": 3,
      "maxLength": 2048,
      "format": "uri"
    },
    "apiToken": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 1,
          "maxLength": 4096
        },
        {
          "type": "null"
        }
      ],
      "writeOnly": true,
      "description": "Bearer API token/key associado ao Connector. ⚠️ Nunca é retornado pela API. Semântica no PUT: requer apiTokenSpecified=true. Com apiTokenSpecified=true: null=remove token; string=substitui token. Com apiTokenSpecified ausente/false: apiToken é ignorado e o token atual é mantido.",
      "examples": [
        "<redacted>",
        null
      ]
    },
    "apiTokenSpecified": {
      "type": "boolean",
      "default": false,
      "writeOnly": true,
      "description": "Flag necessária para distinguir campo omitido vs null no update. No PUT /connectors/{id}: false/ausente => manter token existente; true + apiToken=null => remover; true + apiToken=string => substituir."
    },
    "hasApiToken": {
      "type": "boolean",
      "readOnly": true,
      "description": "Indica se existe um API token configurado para este connector. O valor do token nunca é retornado."
    },
    "timeoutSeconds": {
      "type": "integer",
      "minimum": 1,
      "maximum": 300,
      "default": 60
    },
    "enabled": {
      "type": "boolean",
      "default": true
    },
    "createdAt": {
      "type": [
        "string",
        "null"
      ],
      "format": "date-time"
    },
    "updatedAt": {
      "type": [
        "string",
        "null"
      ],
      "format": "date-time"
    },
    "authType": {
      "type": "string",
      "enum": [
        "NONE",
        "BEARER",
        "API_KEY",
        "BASIC"
      ],
      "default": "NONE",
      "description": "Tipo de autenticação do Connector. BEARER usa apiToken; API_KEY usa apiKeyName+apiKeyLocation+apiKeyValue; BASIC usa basicUsername+basicPassword."
    },
    "apiKeyLocation": {
      "type": "string",
      "enum": [
        "HEADER",
        "QUERY"
      ],
      "description": "Somente quando authType=API_KEY: onde injetar o apiKeyName=apiKeyValue."
    },
    "apiKeyName": {
      "type": "string",
      "minLength": 1,
      "maxLength": 128,
      "description": "Somente quando authType=API_KEY: nome do parâmetro (ex.: X-API-Key ou api_key)."
    },
    "apiKeyValue": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 1,
          "maxLength": 4096
        },
        {
          "type": "null"
        }
      ],
      "writeOnly": true,
      "description": "Somente quando authType=API_KEY: valor secreto (writeOnly). Usar apiKeySpecified para update/removal.",
      "examples": [
        "<redacted>",
        null
      ]
    },
    "apiKeySpecified": {
      "type": "boolean",
      "description": "Semântica PUT: true => aplicar apiKeyValue (string) ou remover (null). Ausente/false => manter."
    },
    "hasApiKey": {
      "type": "boolean",
      "description": "Indica se existe API key configurada (somente leitura). Nunca retorna o valor."
    },
    "basicUsername": {
      "type": "string",
      "minLength": 0,
      "maxLength": 256,
      "description": "Somente quando authType=BASIC: usuário (não-secreto)."
    },
    "basicPassword": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 1,
          "maxLength": 4096
        },
        {
          "type": "null"
        }
      ],
      "writeOnly": true,
      "description": "Somente quando authType=BASIC: senha (writeOnly). Usar basicPasswordSpecified para update/removal.",
      "examples": [
        "<redacted>",
        null
      ]
    },
    "basicPasswordSpecified": {
      "type": "boolean",
      "description": "Semântica PUT: true => aplicar basicPassword (string) ou remover (null). Ausente/false => manter."
    },
    "hasBasicPassword": {
      "type": "boolean",
      "description": "Indica se existe senha BASIC configurada (somente leitura)."
    },
    "requestDefaults": {
      "type": "object",
      "additionalProperties": false,
      "description": "Defaults opcionais aplicados a todas as chamadas via este connector. O ProcessVersion.sourceRequest pode sobrescrever.",
      "properties": {
        "method": {
          "type": "string",
          "enum": [
            "GET",
            "POST"
          ],
          "description": "Default method sugerido para a UI/runner (version pode sobrescrever)."
        },
        "headers": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Headers default (merge)."
        },
        "queryParams": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Query params default (merge)."
        },
        "body": {
          "description": "Body default (usado quando o version não definir body). Aceita JSON (obj/array) ou string.",
          "oneOf": [
            {
              "type": "object",
              "additionalProperties": true
            },
            {
              "type": "array"
            },
            {
              "type": "string"
            },
            {
              "type": "number"
            },
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ]
        },
        "contentType": {
          "type": "string",
          "description": "Content-Type default (override). Ex.: application/json."
        }
      }
    }
  },
  "examples": [
    {
      "id": "dynatrace-prod",
      "name": "Dynatrace - PROD",
      "baseUrl": "https://dynatrace.example/api/v2",
      "REMOVIDO_authRef": "dynatrace-prod-token",
      "timeoutSeconds": 60,
      "enabled": true
    },
    {
      "id": "dynatrace-prod",
      "name": "Dynatrace - PROD",
      "baseUrl": "https://dynatrace.example/api/v2",
      "REMOVIDO_authRef": "dynatrace-prod-token",
      "timeoutSeconds": 60,
      "enabled": true,
      "hasApiToken": true
    }
  ]
}
